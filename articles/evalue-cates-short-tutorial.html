<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short Tutorial • evaluCATE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Short Tutorial">
<meta property="og:description" content="evaluCATE">
<meta property="og:image" content="https://riccardo-df.github.io/evaluCATE/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">evaluCATE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/evalue-cates-short-tutorial.html">Get started</a>
</li>
<li>
  <a href="../articles/denoising.html">Denoising</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/riccardo-df/evaluCATE" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Short Tutorial</h1>
            
      
      
      <div class="hidden name"><code>evalue-cates-short-tutorial.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we show how to use the <code>evaluCATE</code>
package to estimate and make inference about key features of
heterogeneous treatment effects. The discussion is loosely based on
Chernozhukov et al. (2017), Yadlowsky et al. (2021), and Imai and Li
(2022).<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The core idea is that applying machine learning tools to the
estimation of heterogeneous treatment effects may produce “low-quality”
estimates of the Conditional Average Treatment Effects (CATEs). Thus, we
move our target to features of the CATEs that <span class="math inline">\(a)\)</span> are of interest to researchers and
policy makers, and <span class="math inline">\(b)\)</span> can be
consistently estimated under mild assumptions. These features are:</p>
<ul>
<li>Best Linear Predictor (BLP) of the actual CATEs using the estimated
CATEs;</li>
<li>Sorted Group Average Treatment Effects (GATES).</li>
<li>Rank-Weighted Average Treatment Effects (RATEs) induced by the
estimated CATEs.</li>
</ul>
<p>To estimate these objects, we first construct estimates of the CATEs
using an observed training sample, and we then post-process them using
an external validation sample. All of this is performed by calling the
<code>evalue_cates</code> function. Results allow us to evaluate the
quality of our CATEs estimates and to assess whether we detect
systematic heterogeneous effects.</p>
<p>Before diving in the technical details, we need to define
notation:</p>
<ul>
<li>
<span class="math inline">\(Y_i\)</span> → Observed outcome;</li>
<li>
<span class="math inline">\(D_i \in \{ 0, 1\}\)</span> → Treatment
indicator;</li>
<li>
<span class="math inline">\(X_i\)</span> → Covariate vector;</li>
<li>
<span class="math inline">\(\mu ( X_i ) = \mathbb{E} [ Y_i | X_i
]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span>;</li>
<li>
<span class="math inline">\(\mu_d ( X_i ) = \mathbb{E} [ Y_i | X_i,
D_i = d ]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span> among those units such as <span class="math inline">\(D_i = d\)</span>;</li>
<li>
<span class="math inline">\(p ( X_i ) = \mathbb{P} [ D_i = 1 | X_i
]\)</span> → Propensity score;</li>
<li>
<span class="math inline">\(H_i = \frac{D_i - p (X_i)}{p (X_i) ( 1 -
p (X_i) )}\)</span> → Horvitz-Thompson operator;</li>
<li>
<span class="math inline">\(w ( X_i ) = \frac{1}{p ( X_i ) [ 1 - p (
X_i )]}\)</span> → Propensity score weights;</li>
<li>
<span class="math inline">\(\Gamma_i := \mu_1 ( X_i ) - \mu_0 ( X_i
) + \frac{D_i [ Y_i - \mu_1 ( X_i ) ]}{p ( X_i )} - \frac{[ 1 - D_i ] [
Y_i - \mu_0 ( X_i ) ]}{1 - p ( X_i )}\)</span> → Doubly-robust
scores;</li>
<li>
<span class="math inline">\(\tau ( X_i ) = \mathbb{E} [ Y_i ( 1 ) -
Y_i ( 0 ) | X_i ]\)</span> → CATEs.</li>
</ul>
<p>Throughout the rest of the tutorial, we assume SUTVA and
unconfoundedness (e.g., Imbens and Rubin, 2015).</p>
<div class="section level3">
<h3 id="calling-the-evalue_cates-function">Calling the <code>evalue_cates</code> Function<a class="anchor" aria-label="anchor" href="#calling-the-evalue_cates-function"></a>
</h3>
<p>When calling the <code>evalue_cates</code> function, we need to
supply the whole sample using the first three arguments: <code>Y</code>,
<code>D</code>, and <code>X</code>, corresponding to <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span>, and <span class="math inline">\(X_i\)</span>. Additionally, the user must provide
estimates of the CATEs <span class="math inline">\(\hat{\tau} ( X_i
)\)</span> obtained using only the training sample by using the
<code>cates</code> argument. Finally, the argument <code>is_train</code>
must consist of a logical vector with the <code>TRUE</code>s denoting
those observations used to estimate the CATEs. This allows the
<code>evalue_cates</code> function to know which observations must be
used to post-process the CATEs estimates.</p>
<p>Let us see an example. First, we generate some data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">mu0</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Second, we need to split the sample into a training sample and a
validation sample or arbitrary sizes. Here we perform an approximate
50/50 split.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Sample split.</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_tr</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">X_val</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">D_tr</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">D_val</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Y_tr</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">Y_val</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span></code></pre></div>
<p>Third, we have to estimate the CATEs using only the training sample.
Any methodology can be used. Here, we use a honest causal forest.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## CATEs estimation.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grf-labs/grf" class="external-link">grf</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html" class="external-link">causal_forest</a></span><span class="op">(</span><span class="va">X_tr</span>, <span class="va">Y_tr</span>, <span class="va">D_tr</span><span class="op">)</span> <span class="co"># We use only the training sample.</span></span>
<span><span class="va">cates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> <span class="co"># We predict on the whole sample.</span></span></code></pre></div>
<p>We are now able to call the <code>evalue_cates</code> function. As
mentioned above, we need to supply <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span>, and <span class="math inline">\(X_i\)</span> using the first three arguments. The
fourth argument is used to provide estimates <span class="math inline">\(\hat{\tau} ( X_i )\)</span> obtained using only
the training sample. Finally, the fifth argument must be a logical
vector denoting which observations belong to the training sample.</p>
<p>We also have four optional arguments that we can use to supply
estimates of the nuisance functions <span class="math inline">\(p (
\cdot )\)</span>, <span class="math inline">\(\mu ( \cdot )\)</span>,
<span class="math inline">\(\mu_0 ( \cdot )\)</span>, and <span class="math inline">\(\mu_1 ( \cdot )\)</span>. Be careful, as these
estimates must be obtained using only the training sample. If not
provided by the user, these functions are estimated internally via
honest regression forests using only the training sample. In this
vignette, we generated our data by mimicking a Bernoulli experiment,
thus we have knowledge of the actual propensity score (0.5 for all
units). We supply these values in the call below and let the function
estimate the other nuisances internally.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Finally, we have four additional optional arguments. The first of
these arguments controls the number of groups to be formed for the GATES
analysis (details below), with the default number equal to five. The
second of these arguments controls the number of bootstrap replications
used to estimate the standard error of the estimated RATEs (details
below). The third of these arguments controls how to rank units for the
RATE estimation (according to either increasing or decreasing values of
the estimated CATEs). The fourth of these arguments controls whether the
<code>evalue_cates</code> function should print the status of progress
on the console. We use the default of 5 groups, 200 bootstrap
replications, the treatment considered to be beneficial, and prevent the
function from printing the progresses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Call main function.</span></span>
<span><span class="va">pscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y_val</span><span class="op">)</span><span class="op">)</span> <span class="co"># True propensity scores.</span></span>
<span><span class="va">evaluation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evalue_cates.html">evalue_cates</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">D</span>, <span class="va">X</span>, <span class="va">cates</span>, <span class="va">train_idx</span>, pscore <span class="op">=</span> <span class="va">pscore</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>After handling the inputs and running some checks, the
<code>evalue_cates</code> function estimates the BLP, the GATES, and the
RATEs using only the validation sample. In the following, we detail the
main results returned by the function.</p>
</div>
<div class="section level3">
<h3 id="best-linear-predictor">Best Linear Predictor<a class="anchor" aria-label="anchor" href="#best-linear-predictor"></a>
</h3>
<p>The first object estimated by the <code>evalue_cates</code> function
is the BLP of the actual CATEs using the estimated CATEs:</p>
<p><span class="math display">\[ BLP [\tau ( X_i ) | \hat{\tau} ( X_i )]
:= \beta_1 + \beta_2 [ \hat{\tau} ( X_i ) - \mathbb{E} [ \hat{\tau} (
X_i ) ] ]\]</span> with <span class="math inline">\(\beta_1 = \mathbb{E}
[ \tau ( X_i ) ]\)</span> the average treatment effect, and <span class="math inline">\(\beta_2 = Cov [ \tau ( X_i ), \hat{\tau} ( X_i ) ]
/ Var [ \hat{\tau} ( X_i ) ]\)</span>. The BLP is of interest for two
main reasons:</p>
<ul>
<li>First, it is a refined predictor of <span class="math inline">\(\tau
( \cdot )\)</span>, in the sense that it is an unbiased predictor of
<span class="math inline">\(\tau ( \cdot )\)</span> and improves over
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span> in the mean
squared error sense (Chernozhukov et al., 2017);</li>
<li>Second, rejecting the hypothesis <span class="math inline">\(\beta_2
= 0\)</span> means that <span class="math inline">\(a)\)</span> there is
systematic heterogeneity, and <span class="math inline">\(b)\)</span>
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span> is a “good”
predictor.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
</li>
</ul>
<p>The <code>evalue_cates</code> function estimates the BLP using three
different strategies, each involving fitting a suitable linear model
using only observations in the validation sample.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<ul>
<li>
<strong>Weighted Residuals</strong>:</li>
</ul>
<p><span class="math display">\[ Y_i = \beta_1 [ D_i - p ( X_i ) ] +
\beta_2 \{ [ D_i - p ( X_i ) ] [ \hat{\tau} ( X_i ) - \mathbb{E}_{n, V}
[ \hat{\tau} ( X_i ) ] ] \} + \epsilon_i \]</span> with the model fitted
via WLS using weights <span class="math inline">\(w ( X_i)\)</span>, and
<span class="math inline">\(\mathbb{E}_{n, V}\)</span> denoting the
sample average with respect to the validation sample. Results can be
accessed by calling <code>evaluation$BLP$wr_none</code>.
<code>evaluation$BLP$wr_cddf1</code>,
<code>evaluation$BLP$wr_cddf2</code>, and
<code>evaluation$BLP$wr_mck1</code> allow the user to access the results
of the models that build on the one displayed here by adding different
sets of optional covariates (check the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a> for details).</p>
<ul>
<li><strong>Horvitz-Thompson</strong></li>
</ul>
<p><span class="math display">\[ H_i Y_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS. Results can be
accessed by calling <code>evaluation$BLP$ht_none</code>.
<code>evaluation$BLP$ht_cddf1</code>,
<code>evaluation$BLP$ht_cddf2</code>,
<code>evaluation$BLP$ht_mck1</code>,
<code>evaluation$BLP$ht_mck2</code>, and
<code>evaluation$BLP$ht_mck3</code> allow the user to access the results
of the models that build on the one displayed here by adding different
sets of optional covariates (check the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a> for details).</p>
<ul>
<li><strong>AIPW</strong></li>
</ul>
<p><span class="math display">\[ \hat{\Gamma}_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS and the doubly-robust
scores <span class="math inline">\(\Gamma_i\)</span> estimated
internally using the the validation sample and 5-fold cross-fitting.
Results can be accessed by calling <code>evaluation$BLP$aipw</code>.</p>
</div>
<div class="section level3">
<h3 id="sorted-group-average-treatment-effects">Sorted Group Average Treatment Effects<a class="anchor" aria-label="anchor" href="#sorted-group-average-treatment-effects"></a>
</h3>
<p>The second object estimated by the <code>evalue_cates</code> function
are the sorted group average treatment effects, with the groups formed
by cutting the distribution of <span class="math inline">\(\hat{\tau} (
\cdot )\)</span> into <span class="math inline">\(K\)</span> bins:<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<p><span class="math display">\[ \gamma_k := \mathbb{E} [ \tau ( X_i ) |
\ell_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \ell_k ], \,\,\, k = 1, \dots,
K\]</span> with <span class="math inline">\(- \infty = \ell_0 &lt;
\ell_1 &lt; \dots &lt; \ell_K &lt; + \infty\)</span>. The GATES are of
interest for two main reasons:</p>
<ul>
<li>First, they provide a nonlinear predictor of <span class="math inline">\(\tau ( \cdot )\)</span>, as they provide the BLP
of <span class="math inline">\(\tau ( \cdot )\)</span> using the group
indicators <span class="math inline">\(\mathbb{1} ( \ell_{k - 1} \leq
\hat{\tau} ( X_i ) &lt; l_k )\)</span> (Chernozhukov et al., 2017);</li>
<li>Second, they allow us to assess whether there is systematic
heterogeneity. For example, one could test the hypothesis that all the
GATES are the same <span class="math inline">\(\gamma_1 = \dots =
\gamma_K\)</span>, or that the difference between the largest and the
smallest GATES is zero <span class="math inline">\(\gamma_1 =
\gamma_K\)</span>. If we reject these hypotheses, the GATES also provide
a way to quantify how different groups show differential reactions to
the treatment.</li>
</ul>
<p>The <code>evalue_cates</code> function estimates the GATES using the
same three strategies used for the BLP estimation. Additionally,
<code>evalue_cates</code> also implements a nonparametric estimator of
the GATES following the approach of Imai and Li (2022). As before,
estimation is performed using only observations in the validation
sample.</p>
<ul>
<li><strong>Weighted Residuals</strong></li>
</ul>
<p><span class="math display">\[ Y_i = \sum_{k = 1}^K \gamma_k [ D_i - p
( X_i ) ] \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span> with the model fitted via WLS
using weights <span class="math inline">\(w ( X_i)\)</span>. Results can
be accessed by calling <code>evaluation$GATES$wr_none</code>.
<code>evaluation$GATES$wr_cddf1</code>,
<code>evaluation$GATES$wr_cddf2</code>, and
<code>evaluation$GATES$wr_mck1</code> allow the user to access the
results of the models that build on the one displayed here by adding
different sets of optional covariates (check the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a> for details).</p>
<ul>
<li><strong>Horvitz-Thompson</strong></li>
</ul>
<p><span class="math display">\[ H_i Y_i = \sum_{k = 1}^K \gamma_k
\mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span> with the model fitted via OLS.
Results can be accessed by calling
<code>evaluation$GATES$ht_none</code>.
<code>evaluation$GATES$ht_cddf1</code>,
<code>evaluation$GATES$ht_cddf2</code>,
<code>evaluation$GATES$ht_mck1</code>,
<code>evaluation$GATES$ht_mck2</code>, and
<code>evaluation$GATES$ht_mck3</code> allow the user to access the
results of the models that build on the one displayed here by adding
different sets of optional covariates (check the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a> for details).</p>
<ul>
<li><strong>AIPW</strong></li>
</ul>
<p><span class="math display">\[ \hat{\Gamma}_i = \sum_{k = 1}^K
\gamma_k \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span> with the model fitted via OLS and
using the same estimated doubly-robust scores <span class="math inline">\(\hat{\Gamma}_i\)</span> as before. Results can be
accessed by calling <code>evaluation$GATES$aipw</code>.</p>
<ul>
<li><strong>Nonparametric</strong></li>
</ul>
<p><span class="math display">\[ \hat{\gamma}_k = \frac{K}{\sum_{i =
1}^n D_i} \sum_{i = 1}^n Y_i D_i \mathbb{1} ( \hat{\ell}_{k - 1} \leq
\hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) - \frac{K}{\sum_{i = 1}^n [ 1 -
D_i ]} \sum_{i = 1}^n Y_i [ 1 - D_i ] \mathbb{1} ( \hat{\ell}_{k - 1}
\leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) \]</span> We also compute
standard errors using the results of Imai and Li (2022). Results can be
accessed by calling <code>evaluation$GATES$imai_li</code>.</p>
</div>
<div class="section level3">
<h3 id="rank-weighted-average-treatment-effects">Rank-Weighted Average Treatment Effects<a class="anchor" aria-label="anchor" href="#rank-weighted-average-treatment-effects"></a>
</h3>
<p>The third object estimated by the <code>evalue_cates</code> function
is the RATE induced by the estimated CATEs. The RATE allows us to
compare different “prioritization rules” that output a score that ranks
units in terms of intervention benefit, with larger RATEs assigned to
better rules.</p>
<p>Formally, we define a prioritization rule <span class="math inline">\(S : \mathcal{X} \rightarrow \mathcal{R}\)</span>
as any rule that sorts units <span class="math inline">\(i = 1, ...,
n\)</span> in order <span class="math inline">\(j = 1, ..., n\)</span>
in decreasing order of <span class="math inline">\(S ( X_i )\)</span>.
Here we focus on CATE-based rules and set <span class="math inline">\(S
( \cdot ) = \hat{\tau} ( \cdot )\)</span>, that is, we prioritize units
with the largest estimated CATEs.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> <a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
<p>For any given rule <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span>, we define the targeting operator characteristic (TOC)
as:</p>
<p><span class="math display">\[ TOC (u; \hat{\tau}) := \mathbb{E} [ Y_i
( 1 ) - Y_i ( 0 ) | F_S ( \hat{\tau} ( X_i ) \geq 1 - u) ] - \mathbb{E}
[ Y_i ( 1 ) - Y_i ( 0 ) ] \]</span> with <span class="math inline">\(F_\hat{\tau} ( \cdot )\)</span> the cumulative
distribution function of <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span>, and <span class="math inline">\(0 &lt; u \leq 1\)</span>.
<span class="math inline">\(TOC( u; \hat{\tau} )\)</span> measures the
difference between the average treatment effect for units highly ranked
by our estimates <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span> (that is, those units such as <span class="math inline">\(F_S
( \hat{\tau} ( X_i ) \geq 1 - u)\)</span>) and the average treatment
effect for the whole population. Intuitively, if the “quality” of <span class="math inline">\(\hat{\tau} ( \cdot )\)</span> is “good,” then the
average treatment effect for highly-ranked units should be bigger than
the average treatment effect for the whole population.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<p>We can evaluate the “quality” of different estimates of <span class="math inline">\(\tau ( \cdot )\)</span> in terms of weighted
averages of the TOC. These weighted averages are the RATEs, which we
define as:</p>
<p><span class="math display">\[ \theta_{\alpha} ( \hat{\tau} ) :=
\int_0^1 \alpha ( u ) TOC ( u; \hat{\tau} ) d u  \]</span> with <span class="math inline">\(\alpha : ( 0, 1 ] \rightarrow \mathcal{R}\)</span>
a generic weight function.</p>
<p>To estimate the TOC of <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span> evaluated at <span class="math inline">\(u\)</span>, we use
the following sample-averaging estimator:</p>
<p><span class="math display">\[ \widehat{TOC} ( u; \hat{\tau} ) =
\frac{1}{ \lfloor u n \rfloor } \sum_{j = 1}^{\lfloor u n \rfloor}
\hat{\Gamma}_{i ( j )} - \frac{1}{n} \sum_{i = 1}^n \hat{\Gamma}_i
\]</span> where we let <span class="math inline">\(i ( j )\)</span> be
the mapping from rank <span class="math inline">\(j\)</span> to unit
<span class="math inline">\(i\)</span> (e.g., <span class="math inline">\(i ( 1 )\)</span> returns the most-prioritized
unit, and <span class="math inline">\(i ( n )\)</span> returns the
least-prioritized unit) and use the same estimated doubly-robust scores
<span class="math inline">\(\hat{\Gamma}_i\)</span> as before. Notice
that the first sum involves only the most-prioritized units according to
the threshold <span class="math inline">\(u\)</span>.<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<p>Given the TOC estimator, we can estimate the RATE as a weighted
average of the estimated TOCs:</p>
<p><span class="math display">\[ \hat{\theta}_{\alpha} ( \hat{\tau} ) =
\frac{1}{n} \sum_{j = 1}^n \alpha ( \frac{j}{n} ) \widehat{TOC} (
\frac{j}{n}; \hat{\tau} ) \]</span> We rely on the half-sample bootstrap
procedure to estimate the standard error of <span class="math inline">\(\hat{\theta}_{\alpha} ( \cdot )\)</span>. In
particular, the standard deviation of the bootstrap estimates can be
used as an estimator of the standard error of <span class="math inline">\(\hat{\theta}_{\alpha} ( \cdot )\)</span>. We can
then test the null hypothesis <span class="math inline">\(\theta_{\alpha} ( \hat{\tau}) \leq 0\)</span>,
which behaves as the null hypothesis <span class="math inline">\(\beta_2
= 0\)</span> detailed in the Best Linear Predictor section.</p>
<p>The <code>evalue_cates</code> function first estimates the TOCs, and
then estimates the RATE as weighted averages of the estimated TOCs using
two different weight function <span class="math inline">\(\alpha ( \cdot
)\)</span>, thus targeting two different metrics:</p>
<ul>
<li>Area under the TOC curve (AUTOC): it uses a naive weighting scheme
<span class="math inline">\(\alpha ( u ) = 1\)</span> for all <span class="math inline">\(u\)</span>;</li>
<li>Qini coefficient (QINI): it uses a linear weight function <span class="math inline">\(\alpha ( u ) = u\)</span>.</li>
</ul>
<p>Results can be accessed by calling
<code>evaluation$RATE$rate_results</code>.</p>
</div>
<div class="section level3">
<h3 id="compare-results">Compare Results<a class="anchor" aria-label="anchor" href="#compare-results"></a>
</h3>
<p>Our package is compatible with the generic S3 methods
<code>print</code>, <code>summary</code>, and <code>plot</code> that
allow the user to investigate the results.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> This section shows
an example of how these methods can be used to analyze the output of a
single call of the <code>evalue_cates</code> function.</p>
<ul>
<li>
<strong>BLP</strong> The <code>summary</code> method allows the user
to visualize the results of BLP estimation. The method displays the
estimated average treatment effect (<span class="math inline">\(\beta_1\)</span>) and heterogeneity parameter
(<span class="math inline">\(\beta_2\)</span>) for all the methodologies
detailed above. An optional argument controls whether the raw results or
LATEX code for a table will be displayed in the console.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## BLP summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">evaluation</span><span class="op">)</span></span>
<span><span class="co">#&gt; CATEs evaluation results </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated ATE + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; wr_none : -0.06 [-0.356, 0.237] </span></span>
<span><span class="co">#&gt; wr_cddf1: -0.12 [-0.395, 0.152] </span></span>
<span><span class="co">#&gt; wr_cddf2: -0.1 [-0.349, 0.141] </span></span>
<span><span class="co">#&gt; wr_mck1 : -0.11 [-0.356, 0.13] </span></span>
<span><span class="co">#&gt; ht_none : -0.06 [-0.356, 0.237] </span></span>
<span><span class="co">#&gt; ht_cddf1: -0.12 [-0.395, 0.152] </span></span>
<span><span class="co">#&gt; ht_cddf2: -0.11 [-0.355, 0.132] </span></span>
<span><span class="co">#&gt; ht_mck1 : -0.12 [-0.365, 0.125] </span></span>
<span><span class="co">#&gt; ht_mck2 : -0.11 [-0.355, 0.129] </span></span>
<span><span class="co">#&gt; ht_mck3 : -0.1 [-0.342, 0.143] </span></span>
<span><span class="co">#&gt; aipw    : -0.04 [-0.231, 0.143] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated HET + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; wr_none : 1.16 [0.793, 1.527] </span></span>
<span><span class="co">#&gt; wr_cddf1: 1.17 [0.825, 1.51] </span></span>
<span><span class="co">#&gt; wr_cddf2: 1.11 [0.846, 1.38] </span></span>
<span><span class="co">#&gt; wr_mck1 : 1.12 [0.85, 1.385] </span></span>
<span><span class="co">#&gt; ht_none : 1.16 [0.793, 1.527] </span></span>
<span><span class="co">#&gt; ht_cddf1: 1.17 [0.825, 1.51] </span></span>
<span><span class="co">#&gt; ht_cddf2: 1.12 [0.85, 1.38] </span></span>
<span><span class="co">#&gt; ht_mck1 : 1.12 [0.845, 1.386] </span></span>
<span><span class="co">#&gt; ht_mck2 : 1.11 [0.842, 1.371] </span></span>
<span><span class="co">#&gt; ht_mck3 : 1.1 [0.831, 1.361] </span></span>
<span><span class="co">#&gt; aipw    : 1.06 [0.859, 1.265] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; RATEs results + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; AUTOC: 0.88 [0.697, 1.061]</span></span>
<span><span class="co">#&gt; QINI:  0.28 [0.221, 0.332]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">evaluation</span>, latex <span class="op">=</span> <span class="st">"BLP"</span><span class="op">)</span></span>
<span><span class="co">#&gt; \begingroup</span></span>
<span><span class="co">#&gt;     \setlength{\tabcolsep}{8pt}</span></span>
<span><span class="co">#&gt;     \renewcommand{\arraystretch}{1.1}</span></span>
<span><span class="co">#&gt;     \begin{table}[H]</span></span>
<span><span class="co">#&gt;         \centering</span></span>
<span><span class="co">#&gt;         \begin{adjustbox}{width = 1\textwidth}</span></span>
<span><span class="co">#&gt;         \begin{tabular}{@{\extracolsep{5pt}}l c c c c c c c c c c c}</span></span>
<span><span class="co">#&gt;         \\[-1.8ex]\hline</span></span>
<span><span class="co">#&gt;         \hline \\[-1.8ex]</span></span>
<span><span class="co">#&gt;         &amp; wr\_none &amp; wr\_cddf1 &amp; wr\_cddf2 &amp; wr\_mck1 &amp; ht\_none &amp; ht\_cddf1 &amp; ht\_cddf2 &amp; ht\_mck1 &amp; ht\_mck2 &amp; ht\_mck3 &amp; aipw \\</span></span>
<span><span class="co">#&gt;         \addlinespace[2pt]</span></span>
<span><span class="co">#&gt;         \hline \\[-1.8ex] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         ATE ($\beta_1$) &amp; -0.06 &amp; -0.12 &amp; -0.1 &amp; -0.11 &amp; -0.06 &amp; -0.12 &amp; -0.11 &amp; -0.12 &amp; -0.11 &amp; -0.1 &amp; -0.04 \\ </span></span>
<span><span class="co">#&gt;                          &amp;  [-0.356, 0.237] &amp; [-0.395, 0.152] &amp; [-0.349, 0.141] &amp; [-0.356, 0.13] &amp; [-0.356, 0.237] &amp; [-0.395, 0.152] &amp; [-0.355, 0.132] &amp; [-0.365, 0.125] &amp; [-0.355, 0.129] &amp; [-0.342, 0.143] &amp; [-0.231, 0.143] \\ </span></span>
<span><span class="co">#&gt;         HET ($\beta_2$) &amp; 1.16 &amp; 1.17 &amp; 1.11 &amp; 1.12 &amp; 1.16 &amp; 1.17 &amp; 1.12 &amp; 1.12 &amp; 1.11 &amp; 1.1 &amp; 1.06 \\ </span></span>
<span><span class="co">#&gt;                          &amp;  [0.793, 1.527] &amp; [0.825, 1.51] &amp; [0.846, 1.38] &amp; [0.85, 1.385] &amp; [0.793, 1.527] &amp; [0.825, 1.51] &amp; [0.85, 1.38] &amp; [0.845, 1.386] &amp; [0.842, 1.371] &amp; [0.831, 1.361] &amp; [0.859, 1.265] \\ </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         \addlinespace[3pt]</span></span>
<span><span class="co">#&gt;         \\[-1.8ex]\hline</span></span>
<span><span class="co">#&gt;         \hline \\[-1.8ex]</span></span>
<span><span class="co">#&gt;         \end{tabular}</span></span>
<span><span class="co">#&gt;         \end{adjustbox}</span></span>
<span><span class="co">#&gt;         \caption{BLP results. $95\%$ confidence intervals are displayed in brackets under each point estimate.}</span></span>
<span><span class="co">#&gt;         \label{table_blp_results}</span></span>
<span><span class="co">#&gt;     \end{table}</span></span>
<span><span class="co">#&gt; \endgroup</span></span></code></pre></div>
<p>By simulation, we can compute the true average treatment effect as
<code>mean(mu1 - mu0)</code>. We can then compare this quantity to the
estimated <span class="math inline">\(\beta_1\)</span> by any given
model to check the accuracy of the results. Additionally, we can compare
the estimated <span class="math inline">\(\beta_2\)</span> to the true
“quality” of the estimated CATEs, given by
<code>cor(mu1[!train_idx] - mu0[!train_idx], cates[!train_idx])</code>.
This can be done only in simulations with heterogeneous effects. With
this condition met, rejecting the hypothesis <span class="math inline">\(\beta_2 = 0\)</span> means that <span class="math inline">\(\hat{\tau} ( \cdot )\)</span> is a “good”
predictor of <span class="math inline">\(\tau ( \cdot )\)</span>.</p>
<ul>
<li>
<strong>GATES</strong> The <code>plot</code> method allows the user
to visualize the results of GATES estimation. If the optional argument
<code>target</code> is set to <code>"GATES"</code>, the method plots the
estimated average treatment effect of each group (<span class="math inline">\(\{ \hat{\gamma}_k \}_{k = 1}^K\)</span>) for all
the methodologies detailed above. Error bars displaying 95% confidence
intervals are also displayed.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## GATES results.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalue-cates-short-tutorial_files/figure-html/compare-gates-1.png" width="700"></p>
<p>By simulation, we can compute the true GATES in the <span class="math inline">\(k\)</span>-th group as
<code>mean(mu1[!train_idx][x] - mu0[!train_idx][x])</code>, with
<code>x</code> a logical vector denoting those units belonging to the
<span class="math inline">\(k\)</span>-th group. We can then compare
these quantities with those displayed in the plot to check the accuracy
of the results.</p>
<ul>
<li>
<strong>RATE</strong> When displaying the raw results, the
<code>summary</code> method also displays the estimated RATEs and their
confidence intervals. Further investigation of the RATEs results is
provided by the <code>plot</code> method. If the optional argument
<code>target</code> is set to <code>"RATE"</code>, the method plots the
estimated TOC curve.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## RATE results.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"RATE"</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalue-cates-short-tutorial_files/figure-html/compare-rate-1.png" width="700"></p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Complete references to these papers are listed in the
home page.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Notice that most methodologies implemented here are
valid only under randomized experiments, where <span class="math inline">\(p ( \cdot )\)</span> is known.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Failing to reject the hypothesis <span class="math inline">\(\beta_2 = 0\)</span> means that either there is no
heterogeneity or <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span> is a “bad” predictor of <span class="math inline">\(\tau (
\cdot )\)</span>. Without additional evidence, we are not able to
disentangle this.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>The linear regressions are used for estimation purposes.
The identification hinges on linear projections defined at the
population level, with the linear regressions constituting their sample
analogs. This applies also to the identification and estimation of the
GATES.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Additional constructed covariates which are not
necessary for identifying the targets but can significantly reduce the
variance of the estimation can be included in the regressions. For each
of the strategies detailed above, the <code>evalue_cates</code> function
fits a number of linear models, each including a different set of
additional covariates. Details can be found in the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>The <span class="math inline">\(K\)</span> bins can be
defined in various ways. Here we follow the approach of Chernozhukov et
al. (2017) and form the groups by cutting the distribution of <span class="math inline">\(\hat{\tau} ( X_i )\)</span> into <span class="math inline">\(K\)</span> quantiles <span class="math inline">\(\{ \hat{\ell}_k \}_{k = 1}^K\)</span>, with <span class="math inline">\(\hat{\ell}_k = inf \{ c \in \mathcal{R} : \sum_{i
= 1}^n \mathbb{1} ( \hat{\tau} ( X_i ) &gt; c ) \leq nk / K \}\)</span>
the empirical <span class="math inline">\(k\)</span>-th quantile of
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span>. The user can
set <span class="math inline">\(K\)</span> by using the optional
<code>n_groups</code> argument when calling the
<code>evalue_cates</code> function. The default is
<code>n_groups = 5</code>.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>If the treatment is harmful, we prioritize units with
the lowest estimated CATEs.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Prioritization rules can be derived from other
approaches, e.g., risk-based rules. Here we focus on CATE-based rules as
we aim to use the RATEs to evaluate the “quality” of the estimated
CATEs.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>When evaluating active labor market policies, it is
common to check whether the average treatment effect for the treated is
larger than the average treatment effect for the whole population, as
this would denote that the treatment is allocated better than randomly.
<span class="math inline">\(TOC ( \cdot, \cdot )\)</span> uses a similar
idea.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>In practice, we use cumulative sums to estimate <span class="math inline">\(\widehat{TOC} ( \frac{j}{n}; \hat{\tau} )\)</span>
for all units in our validation sample.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>The <code>print</code> and <code>summary</code> methods
return the same output in our package.<a href="#fnref11" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Riccardo Di Francesco.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
