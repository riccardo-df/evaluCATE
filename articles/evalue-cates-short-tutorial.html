<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short Tutorial • evalueCATE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Short Tutorial">
<meta property="og:description" content="evalueCATE">
<meta property="og:image" content="https://riccardo-df.github.io/evalueCATE/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">evalueCATE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/evalue-cates-short-tutorial.html">Get started</a>
</li>
<li>
  <a href="../articles/denoising.html">Denoising</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/riccardo-df/evalueCATE" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Short Tutorial</h1>
            
      
      
      <div class="hidden name"><code>evalue-cates-short-tutorial.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we show how to use the <code>evalueCATE</code>
package to estimate and make inference about key features of
heterogeneous treatment effects. The discussion is loosely based on
Chernozhukov et al. (2017), Yadlowsky et al. (2021), and Imai and Li
(2022).<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>The core idea is that applying machine learning tools to the
estimation of heterogeneous treatment effects may produce “low-quality”
estimates of the Conditional Average Treatment Effects (CATEs). Thus, we
move our target to features of the CATEs that <span class="math inline">\(a)\)</span> are of interest to researchers and
policy makers, and <span class="math inline">\(b)\)</span> can be
consistently estimated under mild assumptions. These features are:</p>
<ul>
<li>Best Linear Predictor (BLP) of the actual CATEs using the estimated
CATEs;</li>
<li>Sorted Group Average Treatment Effects (GATES).</li>
</ul>
<p>To estimate these objects, we first construct estimates of the CATEs
using an observed training sample, and we then post-process them using
an external validation sample. All of this is performed by calling the
<code>evalue_cates</code> function. Results allow us to evaluate the
quality of our CATEs estimates and to assess whether we detect
systematic heterogeneous effects.</p>
<p>Before diving in the technical details, we need to define
notation:</p>
<ul>
<li>
<span class="math inline">\(Y_i\)</span> → Observed outcome;</li>
<li>
<span class="math inline">\(D_i \in \{ 0, 1\}\)</span> → Treatment
indicator;</li>
<li>
<span class="math inline">\(X_i\)</span> → Covariate vector;</li>
<li>
<span class="math inline">\(\mu ( X_i ) = \mathbb{E} [ Y_i | X_i
]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span>;</li>
<li>
<span class="math inline">\(\mu_d ( X_i ) = \mathbb{E} [ Y_i | X_i,
D_i = d ]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span> among those units such as <span class="math inline">\(D_i = d\)</span>;</li>
<li>
<span class="math inline">\(p ( X_i ) = \mathbb{P} [ D_i = 1 | X_i
]\)</span> → Propensity score;</li>
<li>
<span class="math inline">\(H_i = \frac{D_i - p (X_i)}{p (X_i) ( 1 -
p (X_i) )}\)</span> → Horvitz-Thompson operator;</li>
<li>
<span class="math inline">\(w ( X_i ) = \frac{1}{\hat{p} ( X_i ) [ 1
- \hat{p} ( X_i )]}\)</span> → Propensity score weights;</li>
<li>
<span class="math inline">\(\tau ( X_i ) = \mathbb{E} [ Y_i ( 1 ) -
Y_i ( 0 ) | X_i ]\)</span> → CATEs.</li>
</ul>
<div class="section level3">
<h3 id="calling-the-evalue_cates-function">Calling the <code>evalue_cates</code> Function<a class="anchor" aria-label="anchor" href="#calling-the-evalue_cates-function"></a>
</h3>
<p>When calling the <code>evalue_cates</code> function, we need to
supply the whole sample using the first three arguments: <code>y</code>,
<code>D</code>, and <code>X</code>, corresponding to <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span>, and <span class="math inline">\(X_i\)</span>. Additionally, the user must provide
estimates of the CATEs <span class="math inline">\(\hat{\tau} ( X_i
)\)</span> obtained using only the training sample by using the
<code>cates</code> argument. Finally, the argument <code>is_train</code>
must consist of a logical vector with the <code>TRUE</code>s denoting
those observations used to estimate the CATEs. This allows the
<code>evalue_cates</code> function to know which observations must be
used to post-process the CATEs estimates.</p>
<p>Let us see an example. First, we generate some data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">mu0</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Second, we need to split the sample into a training sample and a
validation sample or arbitrary sizes. Here we perform an approximate
50/50 split.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Sample split.</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_tr</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">X_val</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">D_tr</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">D_val</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="va">y_tr</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">y_val</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span></code></pre></div>
<p>Third, we have to estimate the CATEs using only the training sample.
Any methodology can be used. Here, we use a honest regression
forest.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## CATEs estimation.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grf-labs/grf" class="external-link">grf</a></span><span class="op">)</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html" class="external-link">causal_forest</a></span><span class="op">(</span><span class="va">X_tr</span>, <span class="va">y_tr</span>, <span class="va">D_tr</span><span class="op">)</span> <span class="co"># We use only the training sample.</span></span>
<span><span class="va">cates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span> <span class="co"># We predict on the whole sample.</span></span></code></pre></div>
<p>We are now able to call the <code>evalue_cates</code> function. As
mentioned above, we need to supply <span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span>, and <span class="math inline">\(X_i\)</span> using the first three arguments. The
fourth argument is used to provide estimates <span class="math inline">\(\hat{\tau} ( X_i )\)</span> obtained using only
the training sample. Finally, the fifth argument must be a logical
vector denoting which observations belong to the training sample. We
also have an optional sixth argument that we can use to supply the
propensity scores <span class="math inline">\(p ( X_i )\)</span>. In
this vignette, we generated our data by mimicking a Bernoulli
experiment, thus we have knowledge of the actual propensity score (0.5
for all units). Otherwise, we could pass estimates <span class="math inline">\(\hat{p} ( X_i )\)</span> obtained using only the
training sample.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Call main function.</span></span>
<span><span class="va">pscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">evaluation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evalue_cates.html">evalue_cates</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">D</span>, <span class="va">X</span>, <span class="va">cates</span>, is_train <span class="op">=</span> <span class="va">train_idx</span>, pscore <span class="op">=</span> <span class="va">pscore</span><span class="op">)</span></span></code></pre></div>
<p>After handling the inputs and running some checks, the
<code>evalue_cates</code> function estimates the BLP and the GATES using
only the validation sample. In the following, we detail this
process.</p>
</div>
<div class="section level3">
<h3 id="best-linear-predictor">Best Linear Predictor<a class="anchor" aria-label="anchor" href="#best-linear-predictor"></a>
</h3>
<p>The first object targeted by the <code>evalue_cates</code> function
is the BLP of the actual CATEs using the estimated CATEs:</p>
<p><span class="math display">\[ BLP [\tau ( X_i ) | \hat{\tau} ( X_i )]
:= \beta_1 + \beta_2 [ \hat{\tau} ( X_i ) - \mathbb{E} [ \hat{\tau} (
X_i ) ] ]\]</span> with <span class="math inline">\(\beta_1 = \mathbb{E}
[ \tau ( X_i ) ]\)</span> and <span class="math inline">\(\beta_2 = Cov
[ \tau ( X_i ), \hat{\tau} ( X_i ) ] / Var [ \hat{\tau} ( X_i )
]\)</span>. The BLP is of interest for two main reasons:</p>
<ul>
<li>First, it is a refined predictor of <span class="math inline">\(\tau
( \cdot )\)</span>, in the sense that it is an unbiased predictor of
<span class="math inline">\(\tau ( \cdot )\)</span> and improves over
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span> in the mean
squared error sense (Chernozhukov et al., 2017);</li>
<li>Second, rejecting the hypothesis <span class="math inline">\(\beta_2
= 0\)</span> means that <span class="math inline">\(a)\)</span> there is
systematic heterogeneity, and <span class="math inline">\(b)\)</span>
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span> is a “good”
predictor.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
</li>
</ul>
<p>The <code>evalue_cates</code> function estimates the BLP using three
different strategies, each involving fitting a suitable linear model
using only observations in the validation sample.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> <a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<ul>
<li>
<strong>Weighted Residuals</strong>:</li>
</ul>
<p><span class="math display">\[ Y_i = \beta_1 [ D_i - p ( X_i ) ] +
\beta_2 \{ [ D_i - p ( X_i ) ] [ \hat{\tau} ( X_i ) - \mathbb{E}_{n, V}
[ \hat{\tau} ( X_i ) ] ] \} + \epsilon_i \]</span> with the model fitted
via WLS using weights <span class="math inline">\(w ( X_i)\)</span>, and
<span class="math inline">\(\mathbb{E}_{n, V}\)</span> denoting the
sample average with respect to the validation sample. Results can be
accessed by calling <code>evaluation$BLP$wr_none</code>.</p>
<ul>
<li><strong>Horvitz-Thompson</strong></li>
</ul>
<p><span class="math display">\[ H_i Y_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS. Results can be
accessed by calling <code>evaluation$BLP$ht_none</code>.</p>
<ul>
<li><strong>AIPW</strong></li>
</ul>
<p><span class="math display">\[ \hat{\Gamma}_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS, and <span class="math inline">\(\hat{\Gamma}_i := \hat{\mu}_1 ( X_i ) -
\hat{\mu}_0 ( X_i ) + \frac{D_i [ Y_i - \mu_1 ( X_i ) ]}{\hat{p} ( X_i
)} - \frac{[ 1 - D_i ] [ Y_i - \hat{\mu}_0 ( X_i ) ]}{1 - \hat{p} ( X_i
)}\)</span>.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> Results can be accessed by calling
<code>evaluation$BLP$aipw</code>.</p>
</div>
<div class="section level3">
<h3 id="sorted-group-average-treatment-effects">Sorted Group Average Treatment Effects<a class="anchor" aria-label="anchor" href="#sorted-group-average-treatment-effects"></a>
</h3>
<p>The second object targeted by the <code>evalue_cates</code> function
are the group average treatment effects, with the groups formed by
cutting the distribution of <span class="math inline">\(\hat{\tau} (
\cdot )\)</span> into <span class="math inline">\(K\)</span> bins:<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p><span class="math display">\[ \gamma_k := \mathbb{E} [ \tau ( X_i ) |
\ell_{k - 1} \leq \hat{\tau} ( X_i ) &lt; l_k ], \,\,\, k = 1, \dots,
K\]</span> with <span class="math inline">\(- \infty = \ell_0 &lt;
\ell_1 &lt; \dots &lt; \ell_K &lt; + \infty\)</span>. The GATES are of
interest for two main reasons:</p>
<ul>
<li>First, they provided a nonlinear predictor of <span class="math inline">\(\tau ( \cdot )\)</span>, as they provide the BLP
of <span class="math inline">\(\tau ( \cdot )\)</span> using the group
indicators <span class="math inline">\(\mathbb{1} ( \ell_{k - 1} \leq
\hat{\tau} ( X_i ) &lt; l_k )\)</span> (Chernozhukov et al., 2017);</li>
<li>Second, they allow us to assess whether there is systematic
heterogeneity. For example, one could test the hypothesis that all the
GATES are the same <span class="math inline">\(\gamma_1 = \dots =
\gamma_K\)</span>, or that the difference between the largest and the
smallest GATES is zero <span class="math inline">\(\gamma_1 =
\gamma_K\)</span>. If we reject these hypotheses, the GATES also provide
a way to quantify how different groups show differential reactions to
the treatment.</li>
</ul>
<p>The <code>evalue_cates</code> function estimates the GATES using the
same three strategies used for the BLP estimation. As before, all linear
models are fitted using only observations in the validation sample.</p>
<ul>
<li><strong>Weighted Residuals</strong></li>
</ul>
<p><span class="math display">\[ Y_i = \sum_{k = 1}^K \gamma_k [ D_i - p
( X_i ) ] \mathbb{1} ( \ell_{k - 1} \leq \hat{\tau} ( X_i ) &lt; l_k ) +
\epsilon_i \]</span> with the model fitted via WLS using weights <span class="math inline">\(w ( X_i)\)</span>. Results can be accessed by
calling <code>evaluation$GATES$wr_none</code>.</p>
<ul>
<li><strong>Horvitz-Thompson</strong></li>
</ul>
<p><span class="math display">\[ H_i Y_i = \sum_{k = 1}^K \gamma_k
\mathbb{1} ( \ell_{k - 1} \leq \hat{\tau} ( X_i ) &lt; l_k ) +
\epsilon_i \]</span> with the model fitted via OLS. Results can be
accessed by calling <code>evaluation$GATES$ht_none</code>.</p>
<ul>
<li><strong>AIPW</strong></li>
</ul>
<p><span class="math display">\[ \Gamma_i = \sum_{k = 1}^K \gamma_k
\mathbb{1} ( \ell_{k - 1} \leq \hat{\tau} ( X_i ) &lt; l_k ) +
\epsilon_i \]</span> with the model fitted via OLS. Results can be
accessed by calling <code>evaluation$GATES$aipw</code>.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Complete references to these papers are listed in the
home page.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>If we do not use the <code>pscore</code> argument at
all, the <code>evalue_cates</code> function will estimate the propensity
scores internally via a honest regression forest constructed using only
the training sample.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Failing to reject the hypothesis <span class="math inline">\(\beta_2 = 0\)</span> means that either there is no
heterogeneity or <span class="math inline">\(\hat{\tau} ( \cdot
)\)</span> is a “bad” predictor of <span class="math inline">\(\tau (
\cdot )\)</span>. Without additional evidence, we are not able to
disentangle this.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>The linear regressions are used for estimation purposes.
The identification hinges on linear projections defined at the
population level, with the linear regressions constituting their sample
analogs. This applies also to the identification and estimation of the
GATES.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Additional constructed covariates which are not
necessary for identifying the targets but can significantly reduce the
variance of the estimation can be included in the regressions. For each
of the strategies detailed above, the <code>evalue_cates</code> function
fits several linear model, each including a different set of additional
covariates. Details can be found in the <a href="https://riccardo-df.github.io/evalueCATE/articles/denoising.html">denoising
vignette</a>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>The doubly-robust scores <span class="math inline">\(\Gamma_i\)</span> are estimated internally using
the the validation sample and 5-fold cross-fitting.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>The <span class="math inline">\(K\)</span> bins can be
defined in various ways. Here we follow the approach of (Chernozhukov et
al., 2017) and form the groups by cutting the distribution of <span class="math inline">\(\hat{\tau} ( X_i )\)</span> into <span class="math inline">\(K\)</span> quantiles.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Riccardo Di Francesco.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
