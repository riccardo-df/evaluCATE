<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Short Tutorial • evaluCATE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Short Tutorial">
<meta property="og:description" content="evaluCATE">
<meta property="og:image" content="https://riccardo-df.github.io/evaluCATE/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">evaluCATE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/evalue-cates-short-tutorial.html">Get started</a>
</li>
<li>
  <a href="../articles/denoising.html">Denoising</a>
</li>
<li>
  <a href="../articles/hypotheses-testing.html">Hypotheses Testing</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/riccardo-df/evaluCATE" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Short Tutorial</h1>
            
      
      
      <div class="hidden name"><code>evalu-cates-short-tutorial.Rmd</code></div>

    </div>

    
    
<p>In this tutorial, we show how to use the <code>evaluCATE</code>
package to evaluate the quality of our conditional average treatment
effect (CATE) estimates. Before diving in the technical details, we need
to define notation:</p>
<ul>
<li>
<span class="math inline">\(Y_i\)</span> → Observed outcome;</li>
<li>
<span class="math inline">\(D_i \in \{ 0, 1\}\)</span> → Treatment
indicator;</li>
<li>
<span class="math inline">\(X_i\)</span> → Covariate vector;</li>
<li>
<span class="math inline">\(\mu ( X_i ) = \mathbb{E} [ Y_i | X_i
]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span>;</li>
<li>
<span class="math inline">\(\mu_d ( X_i ) = \mathbb{E} [ Y_i | X_i,
D_i = d ]\)</span> → Conditional mean of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i\)</span> among those units such as <span class="math inline">\(D_i = d\)</span>;</li>
<li>
<span class="math inline">\(p ( X_i ) = \mathbb{P} [ D_i = 1 | X_i
]\)</span> → Propensity score;</li>
<li>
<span class="math inline">\(w ( X_i ) = \frac{1}{p ( X_i ) [ 1 - p (
X_i )]}\)</span> → Propensity score weights;</li>
<li>
<span class="math inline">\(H_i = w ( X_i ) [ D_i - p (X_i)
]\)</span> → Horvitz-Thompson operator;</li>
<li>
<span class="math inline">\(\Gamma_i := \mu_1 ( X_i ) - \mu_0 ( X_i
) + \frac{D_i [ Y_i - \mu_1 ( X_i ) ]}{p ( X_i )} - \frac{[ 1 - D_i ] [
Y_i - \mu_0 ( X_i ) ]}{1 - p ( X_i )}\)</span> → Doubly-robust
scores;</li>
<li>
<span class="math inline">\(\tau = \mathbb{E} [ Y_i ( 1 ) - Y_i ( 0
) ]\)</span> → Average treatment effect (ATE);</li>
<li>
<span class="math inline">\(\tau ( X_i ) = \mathbb{E} [ Y_i ( 1 ) -
Y_i ( 0 ) | X_i ]\)</span> → CATEs.</li>
</ul>
<p>Throughout the rest of the tutorial, we assume SUTVA and
unconfoundedness (e.g., Imbens and Rubin, 2015).</p>
<div class="section level2">
<h2 id="motivating-example">Motivating Example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<p>We illustrate the purpose of the <code>evaluCATE</code> package
through the following example, where we generate simulated data. In this
data, we have only one covariate <span class="math inline">\(X_{i, 1}
\sim \mathcal{U} ( 0, 1 )\)</span>, the treatment is randomly allocated
as in a Bernoulli experiment, and the treatment effects are zero for all
units.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Generate data.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1986</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">mu0</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu1</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">mu0</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>We now proceed to estimate the CATEs using an honest causal forest.
To achieve this, we divide our data set into two subsamples: a training
sample for estimation and a validation sample to check our results. The
latter task is achieved by generating two plots: kernel density of the
out-of-sample CATE predictions, and out-of-sample CATE predictions
arranged in ascending order together with pointwise <span class="math inline">\(95\%\)</span> confidence intervals. To enhance
visualization, we smooth the standard errors by a Nadaraya-Watson
regression.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Sample split.</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">X_tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">X_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">D_tr</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">D_val</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="va">Y_tr</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="va">train_idx</span><span class="op">]</span></span>
<span><span class="va">Y_val</span> <span class="op">&lt;-</span> <span class="va">Y</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## CATEs estimation.</span></span>
<span><span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/grf/man/causal_forest.html" class="external-link">causal_forest</a></span><span class="op">(</span><span class="va">X_tr</span>, <span class="va">Y_tr</span>, <span class="va">D_tr</span><span class="op">)</span> <span class="co"># We use only the training sample.</span></span>
<span><span class="va">forest_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">forest</span>, <span class="va">X</span>, estimate.variance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># We predict on the full sample.</span></span>
<span></span>
<span><span class="va">cates</span> <span class="op">&lt;-</span> <span class="va">forest_predictions</span><span class="op">$</span><span class="va">predictions</span> </span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">forest_predictions</span><span class="op">$</span><span class="va">variance.estimates</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Arrange plot data and smooth standard errors.</span></span>
<span><span class="va">plot_dta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"estimated_cates"</span> <span class="op">=</span> <span class="va">cates</span>, <span class="st">"se"</span> <span class="op">=</span> <span class="va">se</span><span class="op">)</span></span>
<span><span class="va">plot_dta</span> <span class="op">&lt;-</span> <span class="va">plot_dta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">plot_dta</span><span class="op">$</span><span class="va">estimated_cates</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">plot_dta</span><span class="op">$</span><span class="va">smoothed_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ksmooth.html" class="external-link">ksmooth</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">plot_dta</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">plot_dta</span><span class="op">$</span><span class="va">se</span>, bandwidth <span class="op">=</span> <span class="fl">100</span>, kernel <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">plot_dta</span><span class="op">$</span><span class="va">CIL</span> <span class="op">&lt;-</span> <span class="va">plot_dta</span><span class="op">$</span><span class="va">estimated_cates</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">plot_dta</span><span class="op">$</span><span class="va">smoothed_se</span></span>
<span><span class="va">plot_dta</span><span class="op">$</span><span class="va">CIU</span> <span class="op">&lt;-</span> <span class="va">plot_dta</span><span class="op">$</span><span class="va">estimated_cates</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">plot_dta</span><span class="op">$</span><span class="va">smoothed_se</span></span>
<span></span>
<span><span class="co">## Plot out-of-sample predicted CATEs.</span></span>
<span><span class="va">kernel_plot</span> <span class="op">&lt;-</span> <span class="va">plot_dta</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimated_cates</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"dodgerblue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Estimated CATEs"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sorted_plot</span> <span class="op">&lt;-</span> <span class="va">plot_dta</span><span class="op">[</span><span class="op">!</span><span class="va">train_idx</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">train_idx</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">estimated_cates</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">CIL</span>, ymax <span class="op">=</span> <span class="va">CIU</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"dodgerblue"</span>, linetype <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Units"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Estimated CATEs"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>        </span>
<span><span class="fu">grid.arrange</span><span class="op">(</span><span class="va">kernel_plot</span>, <span class="va">sorted_plot</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalu-cates-short-tutorial_files/figure-html/cates-estimation-1.png" width="480"></p>
<p>One could look at the left panel of the figure above and conclude
that there is heterogeneity in the treatment effects. However, high
variation in the predictions does not necessarily imply that the effects
are heterogeneous, as it could be that estimation noise is messing with
our results (exactly what is happening in our example!). One could also
look at right panel of the figure above and conclude that the effect is
zero for all units, which is true in our example but in real
applications we would not know whether this is driven again by
estimation noise.</p>
<p>These complications arise because applying machine learning tools to
the estimation of heterogeneous treatment effects may produce
low-quality estimates of the CATEs, as shown in the next figure where we
overlay the true and the estimated CATEs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Plot true and estimated CATEs.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"x1"</span> <span class="op">=</span> <span class="va">X</span>, <span class="st">"true_cates"</span> <span class="op">=</span> <span class="va">mu1</span> <span class="op">-</span> <span class="va">mu0</span>, <span class="st">"estimated_cates"</span> <span class="op">=</span> <span class="va">cates</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">melt</span><span class="op">(</span>id.vars <span class="op">=</span> <span class="st">"x1"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">variable</span>, color <span class="op">=</span> <span class="va">variable</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>name <span class="op">=</span> <span class="st">""</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True"</span>, <span class="st">"Estimated"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tomato"</span>, <span class="st">"dodgerblue"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"CATEs"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.13</span>, <span class="fl">0.85</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>, legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.4</span>, <span class="st">'cm'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalu-cates-short-tutorial_files/figure-html/true-estimated-cates-1.png" width="480"></p>
<p>It is thus crucial to rely on appropriate procedures to evaluate the
quality of the estimated CATEs and assess whether systematic
heterogeneity is detected. This is exactly the purpose of the
<code>evaluCATE</code> package.</p>
</div>
<div class="section level2">
<h2 id="quality-evaluation">Quality Evaluation<a class="anchor" aria-label="anchor" href="#quality-evaluation"></a>
</h2>
<p>The quality evaluation of the estimated CATEs is performed by
targeting three key features of the CATEs:</p>
<ul>
<li>Best Linear Predictor (BLP) of the actual CATEs using the estimated
CATEs;</li>
<li>Sorted Group Average Treatment Effects (GATES).</li>
<li>Rank-Weighted Average Treatment Effects (RATEs) induced by the
estimated CATEs.</li>
</ul>
<p>This section provides an overview of these targets. The discussion is
loosely based on Chernozhukov et al. (2017), Yadlowsky et al. (2021),
and Imai and Li (2022).<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="section level3">
<h3 id="best-linear-predictor">Best Linear Predictor<a class="anchor" aria-label="anchor" href="#best-linear-predictor"></a>
</h3>
<p>The BLP of the actual CATEs using the estimated CATEs is defined as
follows:</p>
<p><span class="math display">\[ BLP [\tau ( X_i ) | \hat{\tau} ( X_i )]
:= \beta_1 + \beta_2 [ \hat{\tau} ( X_i ) - \mathbb{E} [ \hat{\tau} (
X_i ) ] ]\]</span></p>
<p>with <span class="math inline">\(\beta_1 = \mathbb{E} [ \tau ( X_i )
]\)</span> and <span class="math inline">\(\beta_2 = Cov [ \tau ( X_i ),
\hat{\tau} ( X_i ) ] / Var [ \hat{\tau} ( X_i ) ]\)</span>.</p>
<p>We are interested in the estimation of the BLP for two main
reasons:</p>
<ul>
<li>
<span class="math inline">\(\hat{\beta}_1\)</span> provides an
estimate of the ATE;</li>
<li>
<span class="math inline">\(\beta_2 = 0\)</span> if either the
effects are homogeneous or our CATE estimates are “bad.” Thus, rejecting
the hypothesis <span class="math inline">\(\beta_2 = 0\)</span> would
imply that both the effects are heterogeneous and our CATE estimates are
reliable.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
</li>
</ul>
<p>The <code>evaluCATE</code> package estimates the BLP using three
different strategies, each involving fitting a suitable linear model.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> To achieve
valid inference, we require a training-validation sample split, as we
did in the Motivating Example section. Then, estimation of the following
is performed using only the validation sample.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div class="section level5">
<h5 id="blp---weighted-residuals">BLP - <strong>Weighted Residuals</strong>:<a class="anchor" aria-label="anchor" href="#blp---weighted-residuals"></a>
</h5>
<p><span class="math display">\[ Y_i = \beta_1 [ D_i - p ( X_i ) ] +
\beta_2 \{ [ D_i - p ( X_i ) ] [ \hat{\tau} ( X_i ) - \mathbb{E}_n [
\hat{\tau} ( X_i ) ] ] \} + \epsilon_i \]</span> with the model fitted
via WLS using weights <span class="math inline">\(w ( X_i)\)</span> and
<span class="math inline">\(\mathbb{E}_n\)</span> denoting the sample
average operator.</p>
</div>
<div class="section level5">
<h5 id="blp---horvitz-thompson">BLP - <strong>Horvitz-Thompson</strong><a class="anchor" aria-label="anchor" href="#blp---horvitz-thompson"></a>
</h5>
<p><span class="math display">\[ H_i Y_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS.</p>
</div>
<div class="section level5">
<h5 id="blp---aipw">BLP - <strong>AIPW</strong><a class="anchor" aria-label="anchor" href="#blp---aipw"></a>
</h5>
<p><span class="math display">\[ \hat{\Gamma}_i = \beta_1 + \beta_2 \{
\hat{\tau} ( X_i ) - \mathbb{E}_{n, V} [ \hat{\tau} ( X_i ) ] \} +
\epsilon_i \]</span> with the model fitted via OLS and the doubly-robust
scores <span class="math inline">\(\Gamma_i\)</span> estimated using the
validation sample and 5-fold cross-fitting.</p>
</div>
</div>
<div class="section level3">
<h3 id="sorted-group-average-treatment-effects">Sorted Group Average Treatment Effects<a class="anchor" aria-label="anchor" href="#sorted-group-average-treatment-effects"></a>
</h3>
<p>The GATES are defined as follows:</p>
<p><span class="math display">\[ \gamma_k := \mathbb{E} [ \tau ( X_i ) |
\hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ], \,\,\, k
= 1, \dots, K\]</span></p>
<p>with the groups formed by cutting the distribution of <span class="math inline">\(\hat{\tau} ( \cdot )\)</span> into <span class="math inline">\(K\)</span> bins using the empirical quantiles of
<span class="math inline">\(\hat{\tau} ( \cdot )\)</span> <span class="math inline">\(\{ \hat{\ell}_k \}_{k = 1}^K\)</span>.</p>
<p>We are interested in the estimation of the GATES for two main
reasons:</p>
<ul>
<li>They quantify the extent to which the effects differ across
groups;</li>
<li>They allow us to assess whether we detect systematic heterogeneity
or just estimation noise by testing a set of hypotheses (check the <a href="https://riccardo-df.github.io/evaluCATE/articles/hypotheses-testing.html">hypotheses
testing vignette</a> for details).</li>
</ul>
<p>The <code>evaluCATE</code> package estimates the GATES using four
different strategies: three of them involve fitting a suitable linear
model, while the fourth hinges on a nonparametric estimator. To achieve
valid inference, we require a training-validation sample split, as we
did in the Motivating Example section. Then, estimation of the following
is performed using only the validation sample.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<div class="section level5">
<h5 id="gates---weighted-residuals">GATES - <strong>Weighted Residuals</strong><a class="anchor" aria-label="anchor" href="#gates---weighted-residuals"></a>
</h5>
<p><span class="math display">\[ Y_i = \sum_{k = 1}^K \gamma_k [ D_i - p
( X_i ) ] \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span></p>
<p>with the model fitted via WLS using weights <span class="math inline">\(w ( X_i)\)</span>.</p>
</div>
<div class="section level5">
<h5 id="gates---horvitz-thompson">GATES - <strong>Horvitz-Thompson</strong><a class="anchor" aria-label="anchor" href="#gates---horvitz-thompson"></a>
</h5>
<p><span class="math display">\[ H_i Y_i = \sum_{k = 1}^K \gamma_k
\mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span></p>
<p>with the model fitted via OLS.</p>
</div>
<div class="section level5">
<h5 id="gates---aipw">GATES - <strong>AIPW</strong><a class="anchor" aria-label="anchor" href="#gates---aipw"></a>
</h5>
<p><span class="math display">\[ \hat{\Gamma}_i = \sum_{k = 1}^K
\gamma_k \mathbb{1} ( \hat{\ell}_{k - 1} \leq \hat{\tau} ( X_i ) &lt;
\hat{\ell}_k ) + \epsilon_i \]</span></p>
<p>with the model fitted via OLS and the doubly-robust scores <span class="math inline">\(\Gamma_i\)</span> estimated using the validation
sample and 5-fold cross-fitting.</p>
</div>
<div class="section level5">
<h5 id="gates---nonparametric">GATES - <strong>Nonparametric</strong><a class="anchor" aria-label="anchor" href="#gates---nonparametric"></a>
</h5>
<p><span class="math display">\[ \hat{\gamma}_k = \frac{K}{\sum_{i =
1}^n D_i} \sum_{i = 1}^n Y_i D_i \mathbb{1} ( \hat{\ell}_{k - 1} \leq
\hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) - \frac{K}{\sum_{i = 1}^n [ 1 -
D_i ]} \sum_{i = 1}^n Y_i [ 1 - D_i ] \mathbb{1} ( \hat{\ell}_{k - 1}
\leq \hat{\tau} ( X_i ) &lt; \hat{\ell}_k ) \]</span></p>
</div>
</div>
<div class="section level3">
<h3 id="rank-weighted-average-treatment-effects">Rank-Weighted Average Treatment Effects<a class="anchor" aria-label="anchor" href="#rank-weighted-average-treatment-effects"></a>
</h3>
<p>The RATE induced by the estimated CATEs is defined as follows:</p>
<p><span class="math display">\[ \theta_{\alpha} ( \hat{\tau} ) :=
\int_0^1 \alpha ( u ) TOC ( u; \hat{\tau} ) d u  \]</span> where:</p>
<p><span class="math display">\[ TOC (u; \hat{\tau}) := \mathbb{E} [ Y_i
( 1 ) - Y_i ( 0 ) | F ( \hat{\tau} ( X_i ) \geq 1 - u) ] - \mathbb{E} [
Y_i ( 1 ) - Y_i ( 0 ) ] \]</span> with <span class="math inline">\(F (
\cdot )\)</span> the cumulative distribution function of <span class="math inline">\(\hat{\tau} ( \cdot )\)</span>, <span class="math inline">\(0 &lt; u \leq 1\)</span>, and <span class="math inline">\(\alpha : ( 0, 1 ] \rightarrow \mathcal{R}\)</span>
a generic weight function.</p>
<p>The RATE provides a measure of the ability of our estimated CATEs to
prioritize units to treatment in terms of intervention benefit. The idea
is to regard <span class="math inline">\(\hat{\tau} ( \cdot )\)</span>
as a “prioritization rule” that sorts units <span class="math inline">\(i = 1, ..., n\)</span> in order <span class="math inline">\(j = 1, ..., n\)</span> according to their
estimated CATEs, for instance by prioritizing units with the largest
estimated CATEs.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> <a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p>We are interested in the estimation of the RATE for two main
reasons:</p>
<ul>
<li>
<span class="math inline">\(\theta_{\alpha} ( \hat{\tau}_1 ) &gt;
\theta_{\alpha} ( \hat{\tau}_2 )\)</span> means that <span class="math inline">\(\hat{\tau}_1 ( \cdot )\)</span> produces more
accurate CATE estimates than <span class="math inline">\(\hat{\tau}_2 (
\cdot )\)</span>;</li>
<li>
<span class="math inline">\(\theta_{\alpha} ( \hat{\tau} ) =
0\)</span> if either the effects are homogeneous or our CATE estimates
are “bad.” Thus, rejecting the hypothesis <span class="math inline">\(\theta_{\alpha} ( \hat{\tau} ) = 0\)</span> would
imply that both the effects are heterogeneous and our CATE estimates are
reliable.<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>
</li>
</ul>
<p>The <code>evaluCATE</code> package estimates the TOCs and the RATE
using the following sample-averaging estimators:</p>
<p><span class="math display">\[ \widehat{TOC} ( u; \hat{\tau} ) =
\frac{1}{ \lfloor u n \rfloor } \sum_{j = 1}^{\lfloor u n \rfloor}
\hat{\Gamma}_{i ( j )} - \frac{1}{n} \sum_{i = 1}^n \hat{\Gamma}_i
\]</span> <span class="math display">\[ \hat{\theta}_{\alpha} (
\hat{\tau} ) = \frac{1}{n} \sum_{j = 1}^n \alpha ( \frac{j}{n} )
\widehat{TOC} ( \frac{j}{n}; \hat{\tau} ) \]</span> where we let <span class="math inline">\(i ( j )\)</span> be the mapping from rank <span class="math inline">\(j\)</span> to unit <span class="math inline">\(i\)</span> (e.g., <span class="math inline">\(i (
1 )\)</span> returns the most-prioritized unit, and <span class="math inline">\(i ( n )\)</span> returns the least-prioritized
unit) and the doubly-robust scores <span class="math inline">\(\Gamma_i\)</span> are estimated using the
validation sample and 5-fold cross-fitting. Two different weight
functions are considered, each corresponding to a different RATE:</p>
<ul>
<li>
<span class="math inline">\(\alpha ( u ) = 1\)</span> → Area under
the TOC curve (AUTOC)</li>
<li>
<span class="math inline">\(\alpha ( u ) = u\)</span> → Qini
coefficient (QINI)</li>
</ul>
<p>The half-sample bootstrap procedure is used to estimate the standard
error of <span class="math inline">\(\hat{\theta}_{\alpha} ( \cdot
)\)</span>. In particular, the standard deviation of the bootstrap
estimates can be used as an estimator of the standard error of <span class="math inline">\(\hat{\theta}_{\alpha} ( \cdot )\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<p>The BLP, GATES, and RATEs can be estimated by calling the
<code>evalu_cates</code> function. When calling this function, we need
to supply the full sample using the first three arguments:
<code>Y</code>, <code>D</code>, and <code>X</code>, corresponding to
<span class="math inline">\(Y_i\)</span>, <span class="math inline">\(D_i\)</span>, and <span class="math inline">\(X_i\)</span>. Additionally, we must supply our
CATE predictions on the full sample <span class="math inline">\(\hat{\tau} ( X_i )\)</span> obtained using only
the training sample by using the <code>cates</code> argument. Finally,
we must supply a logical vector with the <code>TRUE</code>s denoting
those observations used to estimate the CATEs by using the
<code>is_train</code> argument, so that the <code>evalu_cates</code>
function knows which observations must be used to post-process our CATEs
estimates.</p>
<p>We also have four optional arguments that we can use to supply
estimates of the nuisance functions <span class="math inline">\(p (
\cdot )\)</span>, <span class="math inline">\(\mu ( \cdot )\)</span>,
<span class="math inline">\(\mu_0 ( \cdot )\)</span>, and <span class="math inline">\(\mu_1 ( \cdot )\)</span>. Be careful, as these
estimates must be obtained using only the training sample. If not
provided by the user, these functions are estimated internally via
honest regression forests using only the training sample. In our
Motivating Example, we have knowledge of the actual propensity score,
which equals <span class="math inline">\(0.5\)</span> for all units. We
supply these values in the call below and let the function estimate the
other nuisances internally.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<p>Finally, we have four additional optional arguments. The first of
these arguments controls the number of groups to be formed for the GATES
analysis, with the default number equal to five. The second of these
arguments controls the number of bootstrap replications used to estimate
the standard error of the estimated RATEs. The third of these arguments
controls how to rank units for the RATE estimation (according to either
increasing or decreasing values of the estimated CATEs). The fourth of
these arguments controls whether the <code>evalu_cates</code> function
should print the status of progress on the console. We use the default
of 5 groups, 200 bootstrap replications, the treatment is considered to
be beneficial, and we prevent the function from printing the
progresses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Call main function.</span></span>
<span><span class="va">pscore</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="co"># True propensity scores.</span></span>
<span><span class="va">evaluation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/evalu_cates.html">evalu_cates</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">D</span>, <span class="va">X</span>, <span class="va">cates</span>, <span class="va">train_idx</span>, pscore <span class="op">=</span> <span class="va">pscore</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Let us have a look at the results. The <code>summary</code> method
allows us to visualize the results of the BLP and RATE estimation if the
<code>target</code> argument is set to <code>BLP</code> or the results
of the GATES estimation if the <code>target</code> argument is set to
<code>GATES</code>. The <code>latex</code> argument controls whether the
raw results or LATEX code for a table will be displayed in the
console.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## BLP summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"BLP"</span><span class="op">)</span> <span class="co"># Try 'latex = TRUE'.</span></span>
<span><span class="co">#&gt; BLP and RATEs results </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated ATE + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; wr_none :  0.18 [-0.104,  0.457] </span></span>
<span><span class="co">#&gt; wr_cddf1:  0.08 [-0.170,  0.323] </span></span>
<span><span class="co">#&gt; wr_cddf2:  0.07 [-0.173,  0.314] </span></span>
<span><span class="co">#&gt; wr_mck1 :  0.08 [-0.169,  0.332] </span></span>
<span><span class="co">#&gt; ht_none :  0.18 [-0.104,  0.457] </span></span>
<span><span class="co">#&gt; ht_cddf1:  0.08 [-0.170,  0.323] </span></span>
<span><span class="co">#&gt; ht_cddf2:  0.07 [-0.173,  0.314] </span></span>
<span><span class="co">#&gt; ht_mck1 :  0.08 [-0.171,  0.321] </span></span>
<span><span class="co">#&gt; ht_mck2 :  0.07 [-0.176,  0.314] </span></span>
<span><span class="co">#&gt; ht_mck3 :  0.06 [-0.185,  0.309] </span></span>
<span><span class="co">#&gt; aipw    :  0.05 [-0.207,  0.306] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated HET + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; wr_none : -0.42 [-5.206,  4.362] </span></span>
<span><span class="co">#&gt; wr_cddf1: -0.23 [-4.151,  3.684] </span></span>
<span><span class="co">#&gt; wr_cddf2:  0.08 [-3.827,  3.979] </span></span>
<span><span class="co">#&gt; wr_mck1 : -0.37 [-4.418,  3.688] </span></span>
<span><span class="co">#&gt; ht_none : -0.42 [-5.206,  4.362] </span></span>
<span><span class="co">#&gt; ht_cddf1: -0.23 [-4.151,  3.684] </span></span>
<span><span class="co">#&gt; ht_cddf2:  0.08 [-3.827,  3.979] </span></span>
<span><span class="co">#&gt; ht_mck1 : -0.27 [-4.213,  3.675] </span></span>
<span><span class="co">#&gt; ht_mck2 : -0.11 [-4.018,  3.802] </span></span>
<span><span class="co">#&gt; ht_mck3 : -0.57 [-4.554,  3.407] </span></span>
<span><span class="co">#&gt; aipw    :  0.27 [-3.846,  4.377] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; RATEs results + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; AUTOC:  0.14 [-0.123,  0.402] </span></span>
<span><span class="co">#&gt; QINI:   0.01 [-0.074,  0.087]</span></span></code></pre></div>
<p>The estimated ATEs range between <span class="math inline">\(0.05\)</span> and <span class="math inline">\(0.18\)</span>, with all confidence intervals
covering the true value computed as <code>mean(mu1 - mu0)</code>.
Additionally, we always fail to reject the hypothesis <span class="math inline">\(\beta_2 = 0\)</span>, implying that either the
effects are homogeneous or our CATE estimates are unreliable (we know
both to be true in our example). The estimated RATEs agree with these
findings.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## GATES summary.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span> <span class="co"># Try 'latex = TRUE'.</span></span>
<span><span class="co">#&gt; GATES results </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated GATES + 95% confidence intervals: </span></span>
<span><span class="co">#&gt; wr_none : </span></span>
<span><span class="co">#&gt;     Group 1  0.36 [-0.433, 1.152] </span></span>
<span><span class="co">#&gt;     Group 2  0.25 [-0.428, 0.928] </span></span>
<span><span class="co">#&gt;     Group 3 -0.07 [-0.595, 0.452] </span></span>
<span><span class="co">#&gt;     Group 4  0.33 [-0.236, 0.888] </span></span>
<span><span class="co">#&gt;     Group 5  0.11 [-0.486, 0.710] </span></span>
<span><span class="co">#&gt; wr_cddf1: </span></span>
<span><span class="co">#&gt;     Group 1  0.22 [-0.372, 0.807] </span></span>
<span><span class="co">#&gt;     Group 2  0.03 [-0.474, 0.537] </span></span>
<span><span class="co">#&gt;     Group 3 -0.05 [-0.565, 0.463] </span></span>
<span><span class="co">#&gt;     Group 4  0.37 [-0.169, 0.918] </span></span>
<span><span class="co">#&gt;     Group 5 -0.14 [-0.711, 0.436] </span></span>
<span><span class="co">#&gt; wr_cddf2: </span></span>
<span><span class="co">#&gt;     Group 1  0.19 [-0.391, 0.771] </span></span>
<span><span class="co">#&gt;     Group 2  0.00 [-0.509, 0.518] </span></span>
<span><span class="co">#&gt;     Group 3 -0.08 [-0.592, 0.441] </span></span>
<span><span class="co">#&gt;     Group 4  0.29 [-0.226, 0.816] </span></span>
<span><span class="co">#&gt;     Group 5 -0.03 [-0.596, 0.531] </span></span>
<span><span class="co">#&gt; wr_mck1 : </span></span>
<span><span class="co">#&gt;     Group 1  0.25 [-0.375, 0.868] </span></span>
<span><span class="co">#&gt;     Group 2  0.04 [-0.471, 0.553] </span></span>
<span><span class="co">#&gt;     Group 3 -0.07 [-0.581, 0.447] </span></span>
<span><span class="co">#&gt;     Group 4  0.37 [-0.178, 0.909] </span></span>
<span><span class="co">#&gt;     Group 5 -0.12 [-0.704, 0.461] </span></span>
<span><span class="co">#&gt; ht_none : </span></span>
<span><span class="co">#&gt;     Group 1  0.36 [-0.433, 1.152] </span></span>
<span><span class="co">#&gt;     Group 2  0.25 [-0.428, 0.928] </span></span>
<span><span class="co">#&gt;     Group 3 -0.07 [-0.595, 0.452] </span></span>
<span><span class="co">#&gt;     Group 4  0.33 [-0.236, 0.888] </span></span>
<span><span class="co">#&gt;     Group 5  0.11 [-0.486, 0.710] </span></span>
<span><span class="co">#&gt; ht_cddf1: </span></span>
<span><span class="co">#&gt;     Group 1  0.22 [-0.372, 0.807] </span></span>
<span><span class="co">#&gt;     Group 2  0.03 [-0.474, 0.537] </span></span>
<span><span class="co">#&gt;     Group 3 -0.05 [-0.565, 0.463] </span></span>
<span><span class="co">#&gt;     Group 4  0.37 [-0.169, 0.918] </span></span>
<span><span class="co">#&gt;     Group 5 -0.14 [-0.711, 0.436] </span></span>
<span><span class="co">#&gt; ht_cddf2: </span></span>
<span><span class="co">#&gt;     Group 1  0.19 [-0.391, 0.771] </span></span>
<span><span class="co">#&gt;     Group 2  0.00 [-0.509, 0.518] </span></span>
<span><span class="co">#&gt;     Group 3 -0.08 [-0.592, 0.441] </span></span>
<span><span class="co">#&gt;     Group 4  0.29 [-0.226, 0.816] </span></span>
<span><span class="co">#&gt;     Group 5 -0.03 [-0.596, 0.531] </span></span>
<span><span class="co">#&gt; ht_mck1 : </span></span>
<span><span class="co">#&gt;     Group 1  0.22 [-0.373, 0.813] </span></span>
<span><span class="co">#&gt;     Group 2  0.03 [-0.476, 0.536] </span></span>
<span><span class="co">#&gt;     Group 3 -0.05 [-0.568, 0.461] </span></span>
<span><span class="co">#&gt;     Group 4  0.37 [-0.171, 0.914] </span></span>
<span><span class="co">#&gt;     Group 5 -0.14 [-0.717, 0.433] </span></span>
<span><span class="co">#&gt; ht_mck2 : </span></span>
<span><span class="co">#&gt;     Group 1  0.21 [-0.381, 0.794] </span></span>
<span><span class="co">#&gt;     Group 2  0.03 [-0.468, 0.535] </span></span>
<span><span class="co">#&gt;     Group 3 -0.08 [-0.605, 0.437] </span></span>
<span><span class="co">#&gt;     Group 4  0.35 [-0.182, 0.876] </span></span>
<span><span class="co">#&gt;     Group 5 -0.10 [-0.670, 0.472] </span></span>
<span><span class="co">#&gt; ht_mck3 : </span></span>
<span><span class="co">#&gt;     Group 1  0.24 [-0.363, 0.848] </span></span>
<span><span class="co">#&gt;     Group 2  0.02 [-0.478, 0.527] </span></span>
<span><span class="co">#&gt;     Group 3 -0.08 [-0.597, 0.435] </span></span>
<span><span class="co">#&gt;     Group 4  0.32 [-0.203, 0.851] </span></span>
<span><span class="co">#&gt;     Group 5 -0.14 [-0.728, 0.442] </span></span>
<span><span class="co">#&gt; aipw    : </span></span>
<span><span class="co">#&gt;     Group 1  0.17 [-0.453, 0.793] </span></span>
<span><span class="co">#&gt;     Group 2 -0.06 [-0.602, 0.489] </span></span>
<span><span class="co">#&gt;     Group 3 -0.12 [-0.660, 0.419] </span></span>
<span><span class="co">#&gt;     Group 4  0.32 [-0.244, 0.889] </span></span>
<span><span class="co">#&gt;     Group 5 -0.02 [-0.603, 0.554] </span></span>
<span><span class="co">#&gt;     Group 5  0.23 [-0.319, 0.779] </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Hypotheses testing results (p-values): </span></span>
<span><span class="co">#&gt; wr_none : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.838</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.624</span></span>
<span><span class="co">#&gt; wr_cddf1: </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.699</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.396</span></span>
<span><span class="co">#&gt; wr_cddf2: </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.845</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.588</span></span>
<span><span class="co">#&gt; wr_mck1 : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.708</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.396</span></span>
<span><span class="co">#&gt; ht_none : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.838</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.624</span></span>
<span><span class="co">#&gt; ht_cddf1: </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.699</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.396</span></span>
<span><span class="co">#&gt; ht_cddf2: </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.845</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.588</span></span>
<span><span class="co">#&gt; ht_mck1 : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.696</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.390</span></span>
<span><span class="co">#&gt; ht_mck2 : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.742</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.463</span></span>
<span><span class="co">#&gt; ht_mck3 : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.718</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.367</span></span>
<span><span class="co">#&gt; aipw    : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.801</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : 0.652</span></span>
<span><span class="co">#&gt; imai_li : </span></span>
<span><span class="co">#&gt;     GATES_1 = GATES_2 = ... = GATES_K : 0.977</span></span>
<span><span class="co">#&gt;     GATES_5 = GATES_1                 : NA</span></span></code></pre></div>
<p>All the GATES confidence intervals include the zero, suggesting that
no group is affected by the treatment (true in our example!). The <span class="math inline">\(p\)</span>-values attached to testing the
hypotheses that all the GATES are equal and that the most affected and
the least affected groups feature the same response to the treatment are
large and lead to a failure in rejecting these hypotheses. To better
digest GATES point estimates and confidence intervals, we can use the
<code>plot</code> method setting the <code>target</code> argument to
<code>"GATES"</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## GATES plot.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"GATES"</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalu-cates-short-tutorial_files/figure-html/gates-plot-1.png" width="480"></p>
<p>Finally, we can look at the estimated TOC curve by calling the
<code>plot</code> method setting the <code>target</code> argument to
<code>"TOC"</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## TOC curve.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">evaluation</span>, target <span class="op">=</span> <span class="st">"TOC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="evalu-cates-short-tutorial_files/figure-html/toc-plot-1.png" width="480"></p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Complete references to these papers are listed in the
home page.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Failing to reject this hypothesis means that either
there is no heterogeneity or our CATE estimates are not reliable.
Without additional evidence, we are not able to disentangle this. Check
the <a href="https://riccardo-df.github.io/evaluCATE/articles/hypotheses-testing.html">hypotheses
testing vignette</a> for more details.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The linear regressions are used for estimation purposes.
The identification hinges on linear projections defined at the
population level, with the linear regressions constituting their sample
analogs.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Additional constructed covariates which are not
necessary for identifying the targets but can significantly reduce the
variance of the estimation can be included in the regressions. Details
can be found in the <a href="https://riccardo-df.github.io/evaluCATE/articles/denoising.html">denoising
vignette</a>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>See footnotes 3 and 4.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>If the treatment is harmful, we prioritize units with
the lowest estimated CATEs.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>Prioritization rules can be derived from other
approaches, e.g., risk-based rules. Here we focus on CATE-based rules as
we aim to use the RATEs to evaluate the quality of our estimated
CATEs.<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>See footnote 2.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>Notice that most methodologies implemented here are
valid only under randomized experiments, where <span class="math inline">\(p ( \cdot )\)</span> is known.<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Riccardo Di Francesco.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
